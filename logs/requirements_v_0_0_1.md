# 需求文档 v0.0.1

## 数字身份钱包

### 数字身份构建和管理
**用户第一次打开手机App，显示以下三个按钮**
#### 生成数字身份
用户点击“生成数字身份”按钮，App生成一对新的私钥和地址，将地址在ERC1056注册为identity，在ERC1484注册获得EIN，私钥需要提醒用户使用冷钱包保存
#### 找回数字身份
用户手动输入加密过的恢复密钥，然后解密用来恢复关联地址丢失或被盗用的数字身份，此操作会重置所有关联地址，然后由用户手动选择新地址亦或者重新选择未丢失或未被盗用的关联地址添加至链上成为新的关联地址以重新取回EIN的唯一管理权
#### 创建数字身份
用户点击“创建数字身份”按钮，输入提前创建好或已拥有的私钥，App将私钥对应的地址在ERC1056注册为identity，到ERC1484注册获得EIN，私钥需要提醒用户使用冷钱包保存
#### 关联地址管理
用户可以选择生成任意数量的地址并添加为关联地址，但是每个EIN关联地址最多为三个，由APP检测
#### 恢复地址管理
* 建立数字身份的时候必须有一个恢复地址且恢复地址的私钥必须严格加密并提醒用户用冷钱包形式保存
* 用户可以选择由任意关联地址发起更改恢复地址的操作，限时两周内上一恢复地址可以取消此操作

**以上功能需要保存私钥的，参考下个功能**
#### 保存备份私钥
App将新生成的或者用户新导入的私钥加密保存，并提示用户通过冷钱包形式备份私钥。

**注册数字身份之后进入以下功能**
#### 填写用户profile
用户上传以下信息到IDHub服务器和新注册的数字身份绑定

* 头像
	* 后续可以通过点击头像之后的设置按钮来进行修改
* 昵称
	* 后续可在profile页面点击修改
* 个性签名
	* 后续可在profile页面点击修改

**进入App主页面展示以下功能**
### 用户主页[我]
#### profile
* 头像，点击可放大并提供设置按钮可修改
* 昵称，点击可修改
* 个性签名，点击可修改

#### IDHub会员
* 查询链上claim验证用户是否为IDHub会员
	* 若是点亮会员勋章
	* 若不是会员勋章设为灰色（点灭）
* 点击会员勋章进入投资者身份信息页面
	* 若还未成为会员，则
		* 提醒用户申请会员及显示会员相关权益
		* 显示IDHub会员协议并检测用户阅读之后点选同意按钮才进入下一步
		* 填入身份信息，[参考](https://github.com/idhubnetwork/identity-resources-and-research/blob/master/MagicCircle/%E4%BA%A7%E5%93%81%E6%96%B9%E6%A1%88_did%E7%9B%B8%E5%85%B3.md#9idhub%E4%BC%9A%E5%91%98%E7%94%B3%E8%AF%B7) 
			1. 填入基本身份信息，包括
				* 姓名，`姓/Last Name      名/First Name`，必填
				* 生日，`生日/Date of Birth        （月）/      （日）/     （年）`，必填
				* 国籍，`国籍/ Nationality`，必填
				* 居住国，`居住国/ Country of Residence`，必填
				* 身份证件号码，`身份证件号码/ID Number`
					* 美国可选，若填写需上传身份证件照片（图片或PDF）
					* 中国必填，需上传身份证件照片（图片或PDF）
				* 护照号码，`护照号码/Passport Number`，可选
					* 若填写需上传护照照片（图片或PDF）
			2. 根据国籍和居住地填写基本认证信息，说明如下
				* 若国籍或居住国任一为美国，则填写
					* 地址，`地址/Address`，需上传住址证明照片`Proof of Address`（图片或PDF）
					* 邮箱，`邮箱/eMail`
					* 手机号，`手机号/Phone Number`
					* 纳税号，`纳税号/TaxID`
					* 社保号，`社保号 SSN` 
				* 国籍和居住国都不是美国，则**暂定**填写
					* 地址，`地址/Address`
					* 邮箱，`邮箱/eMail`
					* 手机号，`手机号/Phone Number`
			3. 进行已填信息确认`information confirm`
			4. 进行双因子认证确保邮箱和手机号信息真实可控，以便后续进行账户信息权限管理
				* 短信验证码 `SMS Code`
				* 邮箱认证 `Email confirmation`
			5. 合格投资人所需的认证信息填写，[参考](https://github.com/idhubnetwork/identity-resources-and-research/blob/master/MagicCircle/%E4%BA%A7%E5%93%81%E6%96%B9%E6%A1%88_did%E7%9B%B8%E5%85%B3.md#10%E5%90%88%E6%A0%BC%E6%8A%95%E8%B5%84%E4%BA%BA%E8%AE%A4%E8%AF%81)
			6. 合格购买人所需的认证信息填写，[参考](https://github.com/idhubnetwork/identity-resources-and-research/blob/master/MagicCircle/%E4%BA%A7%E5%93%81%E6%96%B9%E6%A1%88_did%E7%9B%B8%E5%85%B3.md#11%E5%90%88%E6%A0%BC%E6%8A%95%E8%B5%84%E4%BA%BA%E8%AE%A4%E8%AF%81)
			7. 通知用户等待信息审核，提交以下信息至IDHub数据库并严密保存
				* 以上所有已填信息
				* 用户身份标识符密钥对的私钥签名过的会员申请协议，采用EIP191签名方案
	* 查看已提交的信息
	* 编辑更新信息，参考身份信息填入步骤

### 数字资产信息[钱包]
#### 钱包信息
* 地址
* 钱包名称
* 导出私钥（明文、KeyStore文件、助记词）
* 更换钱包按钮
* 二维码收款地址

#### 资产管理
* ETH余额及转账
* Token余额及转账
	* ST
	* ERC20

#### 搜索框
* 用户根据地址、名称搜索资产
* 搜到资产后可添加到资产信息中

### Dapp浏览[浏览]
#### Dapp市场
* IDHub支持的Dapp
* ST平台Dapp

#### 搜索栏和地址栏
* 可输入Dapp名称搜索对应的dapp
* 可输入地址通过webview注入web3的方式访问对应的dapp

### 历史记录[历史]
#### 消息通知
以下行为应被通知

* 系统通知
* 版本更新

#### 操作记录
以下行为应被记录

* 资产转移
* 身份信息授权
* 第三方登录

**以下功能尽量所有页面都有**
### 二维码扫描
增加二维码扫描按钮，可以通过二维码扫描实现以下功能

* 第三方登录，参考IDHub网站的 “OAuth认证服务器”
* 数字资产扫码转账
	* 默认为ETH
	* 进入转账页面后可选数字资产
* OAuth授权
* 扫码签名去中心化Token交易，参考0x Protocal

## IDHub网站
### 身份数据管理
#### 身份数据存储
用户在前端页面或钱包APP申请IDHub会员所提交的身份信息（ **具体请参考数字身份钱包App的 “IDHub会员功能”** ）需要保存在IDHub服务器。
#### KYC
用户提交的身份信息需要调用KYC服务商的api来做KYC审核，要求如下

* 需要调用至少两个KYC服务商的API，IdentityMind和汤森路透
* KYC通过之后，应先在IDHub数据库标记用户为会员，然后自动在链上向用户颁发会员Claim
* 颁发的Claim用来以后做合规投资人认证

#### OAuth资源服务器
向OAuth认证服务器检测第三方携带的acess-token的权限，配合第三方读取权限内允许的用户数据，暂定的可授权数据及权限范围说明如下

* 用户profile，三方登录时可被用户授权
	* 昵称
	* EIN
	* 头像
	* 个性签名
* 用户通过KYC的所有身份数据，仅可向ST平台授权

### OAuth认证服务器
#### 第三方登录
* 第三方网站接入之后用户可用App扫码登录
* 第三方网站可以无需建立用户系统只关联业务数据到用户DID即可正常提供服务
* IDHub网站作为第三方网站接入此OAuth认证服务器（保证扩展性）

#### 授权检查
* 用户系统和DID关联的资源服务器可以接入系统以检查信息访问者的被授权资格和被授权范围
* DID用户可以扫码授权第三方在资源服务器读取自己的数据
* IDHub身份数据的OAuth资源服务器作为一个资源服务器接入此OAuth认证服务器（保证扩展性）

### IDHub会员系统
#### 后台管理系统
一些基本的后台管理功能用于运营人员操作，包括以下

* 会员数据管理
* 链上Claim管理
	* 修改
	* 撤销

#### 会员前端页面
显示IDHub会员服务协议、勋章、权限及相关身份资料等，提供填写身份资料申请会员的功能以及身份资料修改的功能。**具体请参考数字身份钱包App的 “IDHub会员功能” 。**
#### 会员数据
用户提交身份数据申请IDHub会员（ **具体请参考数字身份钱包App的 “IDHub会员功能”** ），身份数据KYC通过之后，在数据库记录会员资格并同时在链上颁发Claim。

## ST平台Demo

### ST发行铸币
使用ERC1400协议在ropsten测试链发行ST，要求如下

* 拥有IDHub链上Claim的用户才可正常转移或接收ST
* 暂定先发行符合基金份额标准的ST

### OTC交易平台
交易ST的OTC平台，说明如下

* 作为第三方接入IDHub的OAuth认证服务器使用DID直接作为用户系统
* 作为第三方经过用户授权从IDHub网站的OAuth资源服务器读取用户的身份信息
* 只有经过IDHub合规投资者认证的用户才可使用OTC交易功能
* OTC交易使用0x Protocal实现去中心化交易
* 网页端所需的去中心化交易订单签名通过钱包APP扫码实现，参考数字身份钱包APP “二维码扫描” 
* 可作为Dapp在数字身份钱包APP “Dapp浏览” 中访问并签名下单